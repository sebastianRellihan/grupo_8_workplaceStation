<!DOCTYPE html>
<html lang="es">

<%# Import del HEAD del documento %>
<%- include("../partials/head", {usesBootstrap: false, title: "Workplace Station - Carrito de compras",
    description: "¿Ya encontraste lo que buscabas? ¡El producto se encuentra a un sólo click de distancia!",
    keywords: "Workplace Station, carrito de compras"}) %> 

<body>
    <%# Import del HADER %>
    <%- include("../partials/header") %>
    
    <main class="main-cart">
        <h1>Carrito de compras</h1>
        <section class="cart-container">
            <div class="cart-products">

                <% if(Array.isArray(products) && products.length != 0){ %>
                    <% products.forEach( product => { %>

                        <article class="cart-item">
                            <img src="<%= product.imageSrc %>" alt="<%= product.shortDescription %>">
                            <div class="cart-item-info">
                                <h2><%= product.title %></h2>
                                <p><span>$<%= product.price %></span></p>
                                <div class="cart-item-actions">
                                    <div class="quantity-selector">
                                        <button>-</button>
                                        <span>1</span>
                                        <button>+</button>
                                    </div>
                                    <button class="cart-actions-empty">Eliminar</button>
                                </div>
                            </div>
                        </article>

                    <% }); %>
                <% } else { %>
                    <h1>Aún no se agregaron productos...</h1>
                <% } %>

            </div>   
            <div class="cart-summary">
                <div class="cart-summary-note-container">
                    <span>Agregar nota de orden:</span>
                    <textarea name="note" id="" cols="30" rows="4" placeholder="¿Podemos ayudarte? Dejá cualquier comentario que consideres necesario..."></textarea>
                </div>
                <% 
                    /* 
                     * Calcula el valor total de los productos.
                     * Cuando se pueda acceder a variables definidas por el usuario,
                     * se va a tener en cuenta el multiplicador de la cantidad que
                     * se desea comprar.
                     */
                    var total = products.reduce((acum, element) => {
                        
                        if(element.discountPercent == 0){
                            return acum + element.price;
                        } else { // Aplica el descuento si lo hay
                            return acum + element.price * (element.discountPercent / 100); 
                        }

                    }, 0); // El 0 es el valor inicial del acumulador
                %>
                <p>Total: <span>$<%= total %></span></p>
            </div>
            <div class="cart-actions">
                <button class="action-button">Comprar</button>
                <button class="cart-actions-empty">Vaciar carrito</button>
            </div>
        </section>
    </main>

    <%# Import del footer %>
    <%- include("../partials/footer") %>

</body>

</html>